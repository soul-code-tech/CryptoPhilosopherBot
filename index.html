<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìà –¢—Ä–µ–π–¥–∏–Ω–≥ –ë–æ—Ç –í–∞—Å—è 3000 –£–Ω–∏–∫–∞–ª—å–Ω—ã–π</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" sizes="180x180" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">

    <style>
        :root {
            --long-color: #27ae60;
            --short-color: #e74c3c;
            --neutral-color: #3498db;
            --bg-color: #1a1a2e;
            --text-color: #e0e0e0;
            --accent-color: #34495e;
            --fear-color: #e74c3c;
            --greed-color: #27ae60;
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #0b0e11;
            color: var(--text-color); 
            padding: 15px; 
            max-width: 1400px; 
            margin: 0 auto; 
            font-size: 14px;
        }
        h1, h2, h3 { 
            color: #f8a5c2; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            text-align: center;
            margin: 15px 0;
        }
        .header { 
            text-align: center; 
            margin-bottom: 20px; 
            padding: 15px; 
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .section { 
            background: #1e222d;
            padding: 20px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 1px solid #2d3341;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        .market-overview {
            background: #232a3a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .fear-greed-container {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
            font-size: 18px;
        }
        .fear { background: rgba(231, 76, 60, 0.3); color: var(--fear-color); }
        .neutral { background: rgba(52, 152, 219, 0.3); color: var(--neutral-color); }
        .greed { background: rgba(39, 174, 96, 0.3); color: var(--greed-color); }
        .prices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .price-item {
            background: #2d3341;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s ease;
        }
        .price-item:hover {
            transform: translateY(-3px);
            background: #3a4254;
        }
        .news-ticker {
            background: #232a3a;
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
            white-space: nowrap;
            box-sizing: border-box;
            color: #e0e0e0;
        }
        .news-ticker-content {
            display: inline-block;
            animation: scrollNews 30s linear infinite;
            padding-left: 100%;
        }
        @keyframes scrollNews {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        .news-item {
            display: inline-block;
            margin-right: 50px;
        }
        .positive { color: var(--greed-color); }
        .negative { color: var(--fear-color); }
        .controls-panel {
            background: #232a3a;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .risk-level {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        @media (max-width: 768px) {
            .risk-level {
                grid-template-columns: 1fr;
            }
        }
        .risk-btn {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: #2d3341;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .risk-btn.active {
            background: #f8a5c2;
            color: #1a1a2e;
        }
        .risk-btn:hover {
            background: #3a4254;
        }
        .extreme-risk {
            background: rgba(231, 76, 60, 0.3) !important;
            color: #e74c3c !important;
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: #2d3341;
            padding: 15px; 
            border-radius: 10px; 
            text-align: center; 
            backdrop-filter: blur(5px);
            border: 1px solid #3a4254;
            transition: transform 0.3s ease;
        }
        .stat-card:hover {
            transform: scale(1.05);
        }
        .progress-bar-container { 
            margin: 15px 0; 
            background: #232a3a;
            padding: 10px;
            border-radius: 10px;
        }
        .progress-bar { 
            height: 25px; 
            background: #2d3341;
            border-radius: 10px; 
            overflow: hidden;
            position: relative;
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1); 
            border-radius: 10px; 
            transition: width 0.5s ease;
            position: relative;
        }
        .menu {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
            background: #232a3a;
            padding: 10px;
            border-radius: 15px;
        }
        .menu-item {
            background: #2d3341;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .menu-item:hover {
            background: #3a4254;
        }
        .menu-item.active {
            background: #f8a5c2;
            color: #1a1a2e;
        }
        .newsletter {
            background: #232a3a;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        input, button { 
            padding: 10px 20px; 
            margin: 5px; 
            border-radius: 8px; 
            border: 2px solid #3a4254;
            background: #2d3341;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        input { 
            background: #1e222d;
            color: white;
            width: 200px;
        }
        button { 
            background: linear-gradient(45deg, #3498db, #2c3e50); 
            color: white; 
            cursor: pointer; 
        }
        button:hover { 
            background: linear-gradient(45deg, #2980b9, #1a252f);
        }
        .test-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b) !important;
        }
        .update-btn {
            background: linear-gradient(45deg, #27ae60, #229954) !important;
        }
        .help-btn {
            background: linear-gradient(45deg, #9b59b6, #8e44ad) !important;
        }
        .time-display {
            text-align: center;
            padding: 10px;
            background: #232a3a;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
        }
        .trade-mode {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .trade-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: #2d3341;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .trade-btn.active {
            background: #4ecdc4;
            color: #1a1a2e;
        }
        .trade-btn:hover {
            background: #3a4254;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #bdc3c7;
        }
        .log-entry {
            background: #232a3a;
            padding: 8px;
            border-radius: 8px;
            margin: 5px 0;
            font-size: 13px;
        }
        .philosophy-log {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #1e222d;
            border-radius: 10px;
        }
        .trade-history {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .trade-history th,
        .trade-history td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #2d3341;
        }
        .trade-history th {
            background: #2d3341;
        }
        .long-trade {
            color: var(--long-color);
            font-weight: bold;
        }
        .short-trade {
            color: var(--short-color);
            font-weight: bold;
        }
        .profit-positive {
            color: var(--long-color);
        }
        .profit-negative {
            color: var(--short-color);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìà –¢—Ä–µ–π–¥–∏–Ω–≥ –ë–æ—Ç –í–∞—Å—è 3000 –£–Ω–∏–∫–∞–ª—å–Ω—ã–π</h1>
        <p><em>–§–∏–ª–æ—Å–æ—Ñ–∏—è + —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç + –ø–ª–µ—á–æ = –ø—Ä–∏–±—ã–ª—å</em></p>
    </div>

    <!-- –ë–µ–≥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π -->
    <div class="news-ticker">
        <div class="news-ticker-content" id="newsTickerContent">
            <!-- –ù–æ–≤–æ—Å—Ç–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>

    <div class="section">
        <div class="dashboard-grid">
            <div>
                <h2>üåç –û–±–∑–æ—Ä —Ä—ã–Ω–∫–∞</h2>
                <div class="market-overview">
                    <div class="time-display" id="timeDisplay">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...</div>
                    <div class="fear-greed-container" id="fearGreedDisplay">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <h3>–¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã</h3>
                    <div class="prices-grid" id="pricesDisplay">
                        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω...</div>
                    </div>
                </div>
            </div>
            <div>
                <h2>üíº –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–æ–º</h2>
                <div class="controls-panel">
                    <div>
                        <input type="number" id="depositAmount" placeholder="–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è" step="1" min="1">
                        <button onclick="depositFunds()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –¥–µ–º–æ-–±–∞–ª–∞–Ω—Å</button>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <h3>–†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏</h3>
                        <div class="trade-mode">
                            <button class="trade-btn" onclick="toggleTradeMode('stable')" id="tradeStable">–°—Ç–∞–±–∏–ª—å–Ω—ã–π</button>
                            <button class="trade-btn" onclick="toggleTradeMode('scalping')" id="tradeScalping">–°–∫–∞–ª—å–ø–∏–Ω–≥</button>
                        </div>
                    </div>
                    
                    <div>
                        <h3>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞</h3>
                        <div class="risk-level">
                            <button class="risk-btn" onclick="setRiskLevel('recommended')" id="riskRecommended">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π (1%)</button>
                            <button class="risk-btn" onclick="setRiskLevel('medium')" id="riskMedium">–°—Ä–µ–¥–Ω–∏–π (2%)</button>
                            <button class="risk-btn" onclick="setRiskLevel('high')" id="riskHigh">–í—ã—Å–æ–∫–∏–π (5%)</button>
                            <button class="risk-btn extreme-risk" onclick="setRiskLevel('extreme')" id="riskExtreme">–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π (10%)</button>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="toggleMode()">üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º: <span id="modeToggleText">–î–ï–ú–û</span></button>
                        <button onclick="forceUpdateBalance()" class="update-btn">üí∞ –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
                        <button onclick="testBingXAPI()" class="test-btn">üß™ –¢–µ—Å—Ç API (30% —Ä–∏—Å–∫)</button>
                        <button onclick="showHelper()" class="help-btn">üí° –ü–æ–º–æ—â—å</button>
                    </div>
                </div>
                
                <div id="balanceDisplay">
                    <div>üìä –î–µ–º–æ-–±–∞–ª–∞–Ω—Å: $0.00</div>
                    <div>üè¶ –†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: $0.00</div>
                </div>
            </div>
        </div>

        <h2>üìä –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
        <div id="progressDisplay">
            <div class="loading">–ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π</div>
        </div>

        <h2>üìú –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫</h2>
        <table class="trade-history">
            <thead>
                <tr>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–ú–æ–Ω–µ—Ç–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–ü–ª–µ—á–æ</th>
                    <th>–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</th>
                    <th>–¶–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞</th>
                    <th>–ü—Ä–∏–±—ã–ª—å</th>
                </tr>
            </thead>
            <tbody id="tradeHistory">
                <tr>
                    <td colspan="7" style="padding: 20px; text-align: center; color: #bdc3c7;">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- –í—Å–ø–ª—ã–≤–∞—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞-–ø–æ–º–æ—â–Ω–∏–∫ -->
    <div id="helperModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: #2c3e50; padding: 20px; border-radius: 15px; max-width: 600px; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
            <h3 style="color: #f8a5c2; text-align: center;">üí° –ü–æ–º–æ—â–Ω–∏–∫ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –±–æ—Ç–æ–º</h3>
            <ul style="line-height: 1.8; font-size: 14px;">
                <li><strong>–†–ï–ê–õ–¨–ù–´–ô –†–ï–ñ–ò–ú:</strong> –ë–æ—Ç —Ç–æ—Ä–≥—É–µ—Ç –≤–∞—à–∏–º–∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–µ–Ω—å–≥–∞–º–∏ –Ω–∞ —Ñ—å—é—á–µ—Ä—Å–Ω–æ–º —Å—á–µ—Ç–µ BingX.</li>
                <li><strong>–î–ï–ú–û-–†–ï–ñ–ò–ú:</strong> –ë–æ—Ç —Ç–æ—Ä–≥—É–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–µ–Ω—å–≥–∞–º–∏ —Å —Ç–æ–π –∂–µ –ª–æ–≥–∏–∫–æ–π –∏ –∫–æ–º–∏—Å—Å–∏—è–º–∏.</li>
                <li><strong>–í–ê–ñ–ù–û:</strong> –ü–µ—Ä–µ–¥ —Ç–æ—Ä–≥–æ–≤–ª–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ USDT –Ω–∞ <strong>—Ñ—å—é—á–µ—Ä—Å–Ω—ã–π —Å—á–µ—Ç</strong> –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ BingX.</li>
                <li><strong>–¢–ï–°–¢ API:</strong> –ö–Ω–æ–ø–∫–∞ "–¢–µ—Å—Ç API" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é —Å —Ä–∏—Å–∫–æ–º 30% –æ—Ç –≤–∞—à–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (–Ω–µ 30% –±–∞–ª–∞–Ω—Å–∞).</li>
                <li><strong>–ê–ù–ê–õ–ò–ó:</strong> –ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–¥–µ–ª–∫–∏ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º.</li>
                <li><strong>–ò–°–¢–û–†–ò–Ø:</strong> –ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏.</li>
                <li><strong>–†–ò–°–ö-–ú–ï–ù–ï–î–ñ–ú–ï–ù–¢:</strong> –ë–æ—Ç –≤—Å–µ–≥–¥–∞ —Ä–∏—Å–∫—É–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1%).</li>
            </ul>
            <button onclick="document.getElementById('helperModal').style.display='none'" style="width: 100%; padding: 10px; margin-top: 15px; background: linear-gradient(45deg, #3498db, #2c3e50); color: white; border: none; border-radius: 8px; cursor: pointer;">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <script>
        let lastLog = '';
        let currentSection = 'dashboard';

        async function updateState() {
            try {
                const response = await fetch('/api/state');
                const state = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                document.getElementById('balanceDisplay').innerHTML = `
                    <div>üìä –î–µ–º–æ-–±–∞–ª–∞–Ω—Å: $${state.balance.toFixed(2)}</div>
                    <div>üè¶ –†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: $${state.realBalance?.toFixed(2) || '–ó–∞–≥—Ä—É–∑–∫–∞...'}</div>
                `;

                document.getElementById('modeToggleText').innerText = state.isRealMode ? '–†–ï–ê–õ–¨–ù–´–ô' : '–î–ï–ú–û';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —Ä–µ–∂–∏–º–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
                document.querySelectorAll('.trade-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`trade${state.tradeMode.charAt(0).toUpperCase() + state.tradeMode.slice(1)}`).classList.add('active');

                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —Ä–∏—Å–∫–∞
                document.querySelectorAll('.risk-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`risk${state.riskLevel.charAt(0).toUpperCase() + state.riskLevel.slice(1)}`).classList.add('active');

                // –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–¥–µ–ª–æ–∫ (–Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ)
                let progressHtml = '';
                state.history.forEach(trade => {
                    if (trade.status === 'OPEN') {
                        const progress = Math.random() * 100;
                        const probability = Math.min(95, Math.max(20, progress * 0.8));
                        const isLong = trade.type === 'LONG';
                        
                        progressHtml += `
                            <div class="progress-bar-container">
                                <div style="font-weight: bold; margin-bottom: 5px; font-size: 13px;">
                                    ${trade.coin} ‚Äî ${trade.type} (–ü–ª–µ—á–æ: ${trade.leverage}x)
                                </div>
                                <div style="font-size: 12px; margin-bottom: 5px;">
                                    –¢–µ–∫—É—â–∞—è: $${trade.currentPrice?.toFixed(2) || '?'} | –í—Ö–æ–¥: $${trade.entryPrice?.toFixed(2) || '?'} | –¶–µ–ª—å: $${trade.takeProfit?.toFixed(2) || '?'}
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%;"></div>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 12px; margin-top: 5px;">
                                    <span>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: ${probability.toFixed(0)}%</span>
                                    <span class="${isLong ? 'long-trade' : 'short-trade'}">${trade.type}</span>
                                </div>
                            </div>
                        `;
                    }
                });
                document.getElementById('progressDisplay').innerHTML = progressHtml || '–ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π';

                // –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ (—Ç–æ–ª—å–∫–æ CLOSED)
                let historyHtml = '';
                const closedTrades = state.history.filter(trade => trade.status === 'CLOSED').slice(-10);
                if (closedTrades.length > 0) {
                    closedTrades.forEach(trade => {
                        const profit = trade.profitPercent ? `${(trade.profitPercent * 100).toFixed(2)}%` : '-';
                        const profitClass = trade.profitPercent > 0 ? 'profit-positive' : trade.profitPercent < 0 ? 'profit-negative' : '';
                        const isLong = trade.type === 'LONG';
                        
                        historyHtml += `
                            <tr>
                                <td style="padding: 8px; font-size: 12px;">${trade.timestamp}</td>
                                <td style="padding: 8px;">${trade.coin}</td>
                                <td style="padding: 8px;"><span class="${isLong ? 'long-trade' : 'short-trade'}">${trade.type}</span></td>
                                <td style="padding: 8px;">${trade.leverage || '1'}x</td>
                                <td style="padding: 8px;">$${trade.entryPrice?.toFixed(2) || 'N/A'}</td>
                                <td style="padding: 8px;">$${trade.exitPrice?.toFixed(2) || 'N/A'}</td>
                                <td style="padding: 8px; color: ${profit.includes('-') ? '#e74c3c' : profit === '-' ? 'white' : '#27ae60'}">${profit}</td>
                            </tr>
                        `;
                    });
                } else {
                    historyHtml = '<tr><td colspan="7" style="padding: 20px; text-align: center;">–ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫</td></tr>';
                }
                document.getElementById('tradeHistory').innerHTML = historyHtml;

                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
                document.getElementById('timeDisplay').innerText = `üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${new Date().toLocaleString()}`;

                // –û–±–Ω–æ–≤–ª—è–µ–º Fear & Greed Index
                updateFearGreedDisplay(state.fearIndex);

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã
                updatePricesDisplay(state.currentPrices);

                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–≥—É—â—É—é —Å—Ç—Ä–æ–∫—É –Ω–æ–≤–æ—Å—Ç–µ–π
                updateNewsTicker(state.marketMemory.news || []);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
            }
        }

        function updateFearGreedDisplay(fearIndex) {
            const fearGreedElement = document.getElementById('fearGreedDisplay');
            
            let fearClass = 'neutral';
            let fearText = `–ò–Ω–¥–µ–∫—Å —Å—Ç—Ä–∞—Ö–∞ –∏ –∂–∞–¥–Ω–æ—Å—Ç–∏: ${fearIndex}`;
            
            if (fearIndex < 25) {
                fearClass = 'fear';
                fearText += ' üò± (–°—Ç—Ä–∞—Ö - –ø–æ–∫—É–ø–∞—Ç—å!)';
            } else if (fearIndex > 75) {
                fearClass = 'greed';
                fearText += ' ü§ë (–ñ–∞–¥–Ω–æ—Å—Ç—å - –ø—Ä–æ–¥–∞–≤–∞—Ç—å!)';
            } else {
                fearText += ' üòê (–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ)';
            }
            
            fearGreedElement.className = `fear-greed-container ${fearClass}`;
            fearGreedElement.innerText = fearText;
        }

        function updatePricesDisplay(prices) {
            let pricesHtml = '';
            if (prices) {
                for (const [coin, price] of Object.entries(prices)) {
                    pricesHtml += `
                        <div class="price-item">
                            <div style="font-weight: bold;">${coin.toUpperCase()}</div>
                            <div style="font-size: 16px; font-weight: bold;">$${price.toFixed(2)}</div>
                        </div>
                    `;
                }
            }
            document.getElementById('pricesDisplay').innerHTML = pricesHtml || '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω...</div>';
        }

        function updateNewsTicker(news) {
            let tickerHtml = '';
            if (news && news.length > 0) {
                news.forEach(item => {
                    let trendClass = '';
                    if (item.sentiment === 'positive') {
                        trendClass = 'positive';
                    } else if (item.sentiment === 'negative') {
                        trendClass = 'negative';
                    }
                    
                    tickerHtml += `
                        <span class="news-item ${trendClass}">
                            ${item.title} ${item.trend} (${item.change24h}) ‚Ä¢
                        </span>
                    `;
                });
            } else {
                tickerHtml = '<span class="news-item">–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π ‚Ä¢</span>';
            }
            document.getElementById('newsTickerContent').innerHTML = tickerHtml;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function updateMarketData() {
            try {
                const newsResponse = await fetch('/api/news');
                const newsData = await newsResponse.json();
                
                globalState.marketMemory.news = newsData.news || [];
                updateNewsTicker(globalState.marketMemory.news);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        async function depositFunds() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            if (isNaN(amount) || amount <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É (–º–∏–Ω–∏–º—É–º $1)');
                return;
            }

            try {
                const response = await fetch('/api/deposit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount })
                });

                const result = await response.json();
                if (result.success) {
                    alert(`–î–µ–º–æ-–±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω! –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: $${result.balance.toFixed(2)}`);
                    updateState();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function toggleMode() {
            try {
                const response = await fetch('/api/toggleMode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                if (result.success) {
                    updateState();
                    alert(result.message);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function toggleTradeMode(mode) {
            try {
                // –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏
                const response = await fetch('/api/toggleTradeMode', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                if (result.success) {
                    // –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    updateState();
                    alert(result.message);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function setRiskLevel(level) {
            try {
                const response = await fetch('/api/setRiskLevel', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ level })
                });

                const result = await response.json();
                if (result.success) {
                    updateState();
                    alert(result.message);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function forceUpdateBalance() {
            try {
                const response = await fetch('/api/forceUpdateBalance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ –ë–∞–ª–∞–Ω—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω: $' + result.balance.toFixed(2));
                    updateState();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + result.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        async function testBingXAPI() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –æ—Ç–∫—Ä–æ–µ—Ç –†–ï–ê–õ–¨–ù–£–Æ –ø–æ–∑–∏—Ü–∏—é —Å —Ä–∏—Å–∫–æ–º 30% –æ—Ç –≤–∞—à–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ BingX.')) {
                return;
            }

            try {
                const response = await fetch('/api/testBingX', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    updateState();
                } else {
                    alert('‚ùå ' + result.message);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        function showHelper() {
            document.getElementById('helperModal').style.display = 'flex';
        }

        async function subscribeNewsletter() {
            const email = document.getElementById('emailInput').value;
            if (!email || !email.includes('@')) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
                return;
            }

            try {
                document.getElementById('newsletterStatus').innerHTML = `
                    <div style="color: #27ae60; margin-top: 10px;">‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É!</div>
                    <div style="font-size: 12px; color: #bdc3c7; margin-top: 5px;">–í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–¥–µ–ª–∫–∞—Ö –∏ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö.</div>
                `;
                alert('–í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É!');
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏: ' + error.message);
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        setInterval(updateState, 3000);
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateMarketData, 30000);
        
        // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
        updateState();
        updateMarketData();
    </script>
</body>
</html>
